---
title: 应用层
createTime: 2025/04/14 08:53:37
permalink: /network/luj6l2rv/
---
## 主机之间的通信方式

+ 客户-服务器（C/S）：客户是服务的请求方，服务器是服务的提供方。![image-20250316154635258](https://xiaokcoding-image.oss-cn-beijing.aliyuncs.com/20250414085416337.png)
+ 对等（P2P）：不区分客户和服务器。![image-20250316154655875](https://xiaokcoding-image.oss-cn-beijing.aliyuncs.com/20250414085416317.png)

## 动态主机配置协议DHCP

DHCP (Dynamic Host Configuration Protocol) 提供了即插即用的连网方式，用户不再需要手动配置 IP 地址等信息。

DHCP 配置的内容不仅是 IP 地址，还包括子网掩码、网关 IP 地址。

DHCP 工作过程如下：

1. 客户端发送 Discover 报文，该报文的目的地址为 255.255.255.255:67，源地址为 0.0.0.0:68，被放入 UDP（DHCP客户，68；DHCP服务器，67）中，该报文被广播到同一个子网的所有主机上。如果客户端和 DHCP 服务器不在同一个子网，就需要使用中继代理。
2. DHCP 服务器收到 Discover 报文之后，发送 Offer 报文给客户端，该报文包含了客户端所需要的信息。因为客户端可能收到多个 DHCP 服务器提供的信息，因此客户端需要进行选择。
3. 如果客户端选择了某个 DHCP 服务器提供的信息，那么就发送 Request 报文给该 DHCP 服务器。
4. DHCP 服务器发送 Ack 报文，表示客户端此时可以使用提供给它的信息。

![image-20250316155313940](https://xiaokcoding-image.oss-cn-beijing.aliyuncs.com/20250414085416320.png)

## 域名系统DNS

DNS 是一个分布式数据库，提供了主机名和 IP 地址之间相互转换的服务。这里的分布式数据库是指，每个站点只保留它自己的那部分数据。

域名具有层次结构，从上到下依次为：根域名、顶级域名、二级域名。

![image-20250316160011832](https://xiaokcoding-image.oss-cn-beijing.aliyuncs.com/20250414085416306.png)

DNS 可以使用 UDP 或者 TCP 进行传输，使用的端口号都为 53。大多数情况下 DNS 使用 UDP 进行传输，这就要求域名解析器和域名服务器都必须自己处理超时和重传从而保证可靠性。在两种情况下会使用 TCP 进行传输：

+ 如果返回的响应超过的 512 字节（UDP 最大只支持 512 字节的数据）。
+ 区域传送（区域传送是主域名服务器向辅助域名服务器传送变化的那部分数据）。

## 文件传送协议FTP

FTP 使用 TCP 进行连接，它需要两个连接来传送一个文件：

+ 控制连接：服务器打开端口号 21 等待客户端的连接，客户端主动建立连接后，使用这个连接将客户端的命令传送给服务器，并传回服务器的应答。
+ 数据连接：用来传送一个文件数据。

根据数据连接是否是服务器端主动建立，FTP 有主动和被动两种模式：

+ 主动模式：服务器端主动建立数据连接，其中服务器端的端口号为 20，客户端的端口号随机，但是必须大于 1024，因为 0~1023 是熟知端口号。![image-20250316160616524](https://xiaokcoding-image.oss-cn-beijing.aliyuncs.com/20250414085416368.png)

+ 被动模式：客户端主动建立数据连接，其中客户端的端口号由客户端自己指定，服务器端的端口号随机。![image-20250316160639457](https://xiaokcoding-image.oss-cn-beijing.aliyuncs.com/20250414085416419.png)

主动模式要求客户端开放端口号给服务器端，需要去配置客户端的防火墙。被动模式只需要服务器端开放端口号即可，无需客户端配置防火墙。但是被动模式会导致服务器端的安全性减弱，因为开放了过多的端口号。

## 电子邮件协议

一个电子邮件系统由三部分组成：用户代理、邮件服务器以及邮件协议。

邮件协议包含发送协议和读取协议，发送协议常用 SMTP，读取协议常用 POP3 和 IMAP。

![image-20250316160955988](https://xiaokcoding-image.oss-cn-beijing.aliyuncs.com/20250414085416649.png)

### SMTP

SMTP 只能发送 ASCII 码，而互联网邮件扩充 MIME 可以发送二进制文件。MIME 并没有改动或者取代 SMTP，而是增加邮件主体的结构，定义了非 ASCII 码的编码规则。

![image-20250316161105414](https://xiaokcoding-image.oss-cn-beijing.aliyuncs.com/20250414085416730.png)

### POP3

用户只能以下载并删除方式或者下载并保留方式从邮件服务器下载邮件到用户计算机，不允许用户在邮件服务器上管理自己的邮件。

### IMNP

用户在自己的计算机上就可以操控邮件服务器中的邮箱（联机协议，POP：110；IMAP4:143）

## 常用端口

![image-20250316161912190](https://xiaokcoding-image.oss-cn-beijing.aliyuncs.com/20250414085416778.png)